<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HTIL Educational Website</title>
    <link rel=stylesheet href="./style.css">
</head>
<body>
    <section>
        <h1>Signals</h1>
        <p>This is a module on signals.</p>
        <div id="editor"></div>
    </section>
</body>
<script type="module">

    import * as brainsatplay from './external/brainsatplay/index.esm.js'
    import * as editorComponents from './external/editor/index.esm.js'

    import appInfo from './content/signals/index.js'
    const app = new brainsatplay.App(appInfo)
    // const app = new brainsatplay.editable.App(appInfo)
    const editor = new editorComponents.Editor()
    editor.setApp(app)


    const ui = document.createElement('div')
    const button = document.createElement('button')
    button.innerHTML = 'Click me'
    ui.appendChild(button)

    editor.setUI(ui)

    let activeApp = app
    if (activeApp.active) activeApp = activeApp.active

    app.onstart = () => {

        editor.start()

        let sub = null
        let node = null

        activeApp.graph.nodes.forEach(n => {
            // if (!node && n.tag.includes('sine')) {
            //     node = n
            //     sub = n.subscribe((data) => {
            //         ui.data = [data]
            //         ui.draw()
            //     })
            //     return true
            // }
        })

        app.onstop = () => {
            if (node) node.unsubscribe(sub)
        }
    }

    const ok = await app.start(appInfo).catch(e => console.error('Invalid App', e))
    if (ok) editor.setGraph(activeApp.graph)


    document.getElementById('editor').appendChild(editor)

    // app.save() // Global save.

</script>
</html>